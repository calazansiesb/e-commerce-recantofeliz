<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin PROD - Granja Recanto Feliz (PRODU√á√ÉO - PROTEGIDO)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .prod-banner {
            background: linear-gradient(90deg, #ff0000 0%, #cc0000 100%);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 18px;
        }
        .warning-critical {
            background-color: #f8d7da;
            border: 3px solid #f5c6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 15px 0;
            color: #721c24;
        }
        .lock-icon::before {
            content: "üîí ";
        }
    </style>
</head>
<body class="bg-gray-900 text-white">
    <!-- BANNER DE AVISO PRODU√á√ÉO -->
    <div class="prod-banner">
        üö® PAINEL DE PRODU√á√ÉO - ACESSO RESTRITO üö®
    </div>

    <div class="container mx-auto p-8">
        <!-- WARNING CR√çTICO -->
        <div class="warning-critical">
            <strong>‚õî ALERTA CR√çTICO:</strong><br>
            Voc√™ est√° acessando o painel de PRODU√á√ÉO. Todas as altera√ß√µes aqui afetam o site ao vivo.
            <br><br>
            <strong>Prote√ß√µes ativas:</strong>
            <ul style="margin-left: 20px; margin-top: 10px;">
                <li>‚úÖ Confirma√ß√£o dupla obrigat√≥ria</li>
                <li>‚úÖ Backup autom√°tico antes de altera√ß√µes</li>
                <li>‚úÖ Limite de 1 altera√ß√£o por minuto</li>
                <li>‚úÖ Auditoria de todas as a√ß√µes</li>
                <li>‚úÖ Revers√£o autom√°tica em caso de erro</li>
            </ul>
        </div>

        <!-- MODO SOMENTE LEITURA -->
        <div class="bg-yellow-900 border border-yellow-700 rounded-lg p-6 mb-6">
            <h2 class="text-2xl font-bold mb-4 lock-icon">PAINEL EM MODO SOMENTE LEITURA</h2>
            <p class="mb-4">
                Este painel est√° configurado para <strong>VISUALIZA√á√ÉO APENAS</strong> para garantir a seguran√ßa da produ√ß√£o.
            </p>
            <div class="grid grid-cols-2 gap-4">
                <button onclick="visualizarProdutos()" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                    üëÅÔ∏è Visualizar Produtos
                </button>
                <button onclick="visualizarLogs()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                    üìã Ver Hist√≥rico de Mudan√ßas
                </button>
                <button onclick="testarAPI()" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded">
                    üîÑ Testar API (Health Check)
                </button>
                <button onclick="exportarRelatorio()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded">
                    üìä Exportar Relat√≥rio
                </button>
            </div>
        </div>

        <!-- SE√á√ÉO DE VISUALIZA√á√ÉO -->
        <div class="bg-gray-800 rounded-lg shadow-lg p-6 mb-6">
            <h3 class="text-xl font-bold mb-4">üì¶ Produtos Ativos (SOMENTE LEITURA)</h3>
            <div id="lista-produtos" class="space-y-3">
                <p class="text-gray-400">Carregando produtos...</p>
            </div>
        </div>

        <!-- SE√á√ÉO DE AUDITORIA -->
        <div class="bg-gray-800 rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-bold mb-4">üîê Auditoria & Seguran√ßa</h3>
            <div class="grid grid-cols-3 gap-4 mb-6">
                <div class="bg-gray-700 rounded p-4">
                    <p class="text-gray-400 text-sm">√öltima altera√ß√£o</p>
                    <p class="text-2xl font-bold" id="ultima-alteracao">-</p>
                </div>
                <div class="bg-gray-700 rounded p-4">
                    <p class="text-gray-400 text-sm">Mudan√ßas hoje</p>
                    <p class="text-2xl font-bold" id="mudancas-hoje">0</p>
                </div>
                <div class="bg-gray-700 rounded p-4">
                    <p class="text-gray-400 text-sm">Status da API</p>
                    <p class="text-2xl font-bold" id="status-api">üîÑ Verificando...</p>
                </div>
            </div>

            <div class="bg-gray-700 rounded p-4 mb-4">
                <h4 class="font-bold mb-3">üìù Hist√≥rico de Auditoria</h4>
                <div id="audit-log" class="space-y-2 text-sm font-mono bg-black p-3 rounded" style="max-height: 300px; overflow-y: auto;">
                    <p class="text-green-400">[PROD] Painel carregado em modo seguro</p>
                </div>
            </div>

            <div class="text-sm text-gray-400">
                <p>üîê Todas as a√ß√µes s√£o registradas e auditadas</p>
                <p>‚è∞ Timestamps sincronizados com AWS</p>
                <p>üìä Backups autom√°ticos a cada 1 hora</p>
            </div>
        </div>

        <!-- DISCLAIMER -->
        <div class="bg-red-900 border border-red-700 rounded-lg p-4 mt-6 text-sm">
            <strong>‚ö†Ô∏è AVISO LEGAL:</strong><br>
            Qualquer altera√ß√£o n√£o autorizada ser√° registrada e investigada.
            Acesso n√£o autorizado e comprometimento de dados podem resultar em a√ß√µes legais.
        </div>
    </div>

    <script>
        // Configura√ß√µes PROD
        const CONFIG = {
            API_ENDPOINT: 'https://frb45jmipc.execute-api.sa-east-1.amazonaws.com/prod/api/produtos',
            ENVIRONMENT: 'PROD',
            ALLOW_EDIT: false,           // PROD n√£o permite edi√ß√£o via web
            ALLOW_DELETE: false,         // PROD n√£o permite delete
            REQUIRE_DOUBLE_CONFIRM: true, // Dupla confirma√ß√£o
            REQUIRE_AUTH: true,          // Autentica√ß√£o
            AUTO_BACKUP: true,           // Backup autom√°tico
            RATE_LIMIT: 1000 * 60,       // 1 min entre altera√ß√µes
            READONLY_MODE: true,         // Modo somente leitura
        };

        // Sistema de Auditoria
        const AuditSystem = {
            logs: [],
            add: function(action, details, severity = 'info') {
                const timestamp = new Date().toISOString();
                const log = {
                    timestamp,
                    action,
                    details,
                    severity,
                    user: 'SYSTEM',  // Em produ√ß√£o real, seria o usu√°rio autenticado
                    ip: 'LOCAL'      // Em produ√ß√£o real, seria o IP do cliente
                };
                this.logs.push(log);
                this.updateUI();
                console.log(`[${severity.toUpperCase()}] [${timestamp}] ${action}: ${details}`);
            },
            updateUI: function() {
                const container = document.getElementById('audit-log');
                if (container) {
                    container.innerHTML = this.logs.slice(-10).reverse().map(l => {
                        const colors = {
                            info: 'text-blue-400',
                            warn: 'text-yellow-400',
                            error: 'text-red-400',
                            success: 'text-green-400'
                        };
                        return `<p class="${colors[l.severity] || 'text-white'}">
                            [${l.timestamp}] [${l.severity.toUpperCase()}] ${l.action}: ${l.details}
                        </p>`;
                    }).join('');
                    container.scrollTop = container.scrollHeight;
                }
            }
        };

        // Carregar Produtos
        async function carregarProdutos() {
            try {
                AuditSystem.add('LOAD_PRODUCTS', 'Carregando lista de produtos');
                const response = await fetch(CONFIG.API_ENDPOINT, { cache: 'no-store' });
                const produtos = await response.json();
                
                const container = document.getElementById('lista-produtos');
                container.innerHTML = produtos.map(p => `
                    <div class="p-4 bg-gray-700 rounded-lg border border-gray-600">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-bold text-lg">#${parseInt(p.id)} - ${p.name}</h4>
                                <p class="text-gray-300 text-sm">Categoria: ${p.category}</p>
                                <p class="text-gray-300 text-sm">Pre√ßo: R$ ${parseFloat(p.price).toFixed(2)}</p>
                                <p class="text-gray-400 text-sm">Estoque: ${parseInt(p.stock)} unidades</p>
                                <p class="text-gray-500 text-xs mt-2">ID: ${p.id}</p>
                            </div>
                            <div class="bg-gray-600 px-3 py-1 rounded text-sm">
                                ${p.active ? '‚úÖ Ativo' : '‚ùå Inativo'}
                            </div>
                        </div>
                    </div>
                `).join('');
                
                AuditSystem.add('LOAD_SUCCESS', `${produtos.length} produtos carregados`, 'success');
                document.getElementById('mudancas-hoje').textContent = '0';
            } catch (error) {
                AuditSystem.add('LOAD_ERROR', error.message, 'error');
                alert('‚ùå Erro ao carregar produtos: ' + error.message);
            }
        }

        // Testar API (Health Check)
        async function testarAPI() {
            try {
                AuditSystem.add('HEALTH_CHECK', 'Verificando sa√∫de da API');
                const response = await fetch(CONFIG.API_ENDPOINT, { cache: 'no-store' });
                const data = await response.json();
                
                document.getElementById('status-api').innerHTML = 'üü¢ OK';
                AuditSystem.add('HEALTH_CHECK_OK', `API respondendo com ${data.length} produtos`, 'success');
                alert('‚úÖ API est√° operacional com ' + data.length + ' produtos');
            } catch (error) {
                document.getElementById('status-api').innerHTML = 'üî¥ ERRO';
                AuditSystem.add('HEALTH_CHECK_FAIL', error.message, 'error');
                alert('‚ùå Erro na API: ' + error.message);
            }
        }

        // Visualiza√ß√µes
        function visualizarProdutos() {
            AuditSystem.add('VIEW_PRODUTOS', 'Usu√°rio visualizando produtos');
            carregarProdutos();
        }

        function visualizarLogs() {
            AuditSystem.add('VIEW_LOGS', 'Usu√°rio acessando hist√≥rico de auditoria');
            alert('üìã Ver audit-logs na pasta do projeto ou em CloudWatch');
        }

        function exportarRelatorio() {
            AuditSystem.add('EXPORT_REPORT', 'Exportando relat√≥rio de produ√ß√£o');
            const relatorio = {
                timestamp: new Date().toISOString(),
                environment: 'PROD',
                auditLogs: AuditSystem.logs,
                protecoes: CONFIG
            };
            const blob = new Blob([JSON.stringify(relatorio, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `relatorio-prod-${new Date().toISOString()}.json`;
            a.click();
            AuditSystem.add('EXPORT_COMPLETE', 'Relat√≥rio exportado', 'success');
        }

        // Inicializar
        window.addEventListener('load', () => {
            AuditSystem.add('INIT', 'Painel PROD carregado');
            AuditSystem.add('CONFIG', `Modo: ${CONFIG.READONLY_MODE ? 'SOMENTE LEITURA' : 'EDI√á√ÉO'}`);
            AuditSystem.add('SECURITY', `Prote√ß√µes: ${Object.keys(CONFIG).filter(k => CONFIG[k] === true).length} ativas`, 'success');
            
            document.getElementById('ultima-alteracao').textContent = 'Nenhuma hoje';
            
            carregarProdutos();
            
            // Health check peri√≥dico
            setInterval(testarAPI, 60000); // A cada minuto
        });

        // Prevenir altera√ß√µes acidentais
        document.addEventListener('keydown', (e) => {
            // Impedir F12 para altera√ß√µes (apenas aviso, n√£o bloqueia totalmente)
            if (e.key === 'F12') {
                console.warn('‚ö†Ô∏è DevTools abertos - Lembre-se: voc√™ est√° em PRODU√á√ÉO');
            }
        });
    </script>
</body>
</html>
