<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulta Direta SQLite</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .button:hover { background: #45a049; }
        pre { background: #f8f8f8; padding: 15px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .highlight { background: yellow; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóÑÔ∏è Consulta Direta SQLite</h1>
        
        <div class="section">
            <h2>Controles</h2>
            <button class="button" onclick="consultarSQLite()">üîç Consultar SQLite</button>
            <button class="button" onclick="consultarProdutoEspecifico()">üéØ Produto ID 2 (FertiGota)</button>
        </div>

        <div class="section">
            <h3>üìä Resultado da Consulta</h3>
            <div id="resultado-sqlite"></div>
        </div>
    </div>

    <!-- sqlite disabled: <script src="js/sqlite-manager.js"></script> -->
    <script>
        function consultarSQLite() {
            const resultado = document.getElementById('resultado-sqlite');
            resultado.innerHTML = '<p>üîç Consultando SQLite...</p>';
            
            try {
                if (!window.sqliteManager) {
                    window.sqliteManager = new SQLiteManager();
                }
                
                if (window.sqliteManager.db) {
                    // Executar consulta direta
                    const stmt = window.sqliteManager.db.prepare("SELECT * FROM products ORDER BY id");
                    const produtos = [];
                    
                    while (stmt.step()) {
                        const row = stmt.getAsObject();
                        produtos.push(row);
                    }
                    stmt.free();
                    
                    let html = `<h4>üìã Todos os produtos no SQLite (${produtos.length} encontrados):</h4>`;
                    
                    if (produtos.length > 0) {
                        html += '<pre>';
                        produtos.forEach(produto => {
                            // Destacar o produto ID 2 (FertiGota)
                            if (produto.id === 2) {
                                html += `<span class="highlight">ID: ${produto.id} | Nome: ${produto.name} | Pre√ßo: R$ ${parseFloat(produto.price).toFixed(2)} | Categoria: ${produto.category}</span>\n`;
                            } else {
                                html += `ID: ${produto.id} | Nome: ${produto.name} | Pre√ßo: R$ ${parseFloat(produto.price).toFixed(2)} | Categoria: ${produto.category}\n`;
                            }
                        });
                        html += '</pre>';
                        
                        // Verificar especificamente o produto ID 2
                        const produto2 = produtos.find(p => p.id === 2);
                        if (produto2) {
                            if (parseFloat(produto2.price) === 5.00) {
                                html += `
                                    <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 10px; margin: 10px 0; border-radius: 4px;">
                                        <strong>‚úÖ CONFIRMADO!</strong><br>
                                        O produto "FertiGota" (ID: 2) tem o pre√ßo correto de R$ 5,00 no SQLite.
                                    </div>
                                `;
                            } else {
                                html += `
                                    <div style="background: #f8d7da; border: 1px solid #f5c6cb; padding: 10px; margin: 10px 0; border-radius: 4px;">
                                        <strong>‚ùå PROBLEMA!</strong><br>
                                        O produto "FertiGota" (ID: 2) tem pre√ßo de R$ ${parseFloat(produto2.price).toFixed(2)} no SQLite, mas deveria ser R$ 5,00.
                                    </div>
                                `;
                            }
                        }
                    } else {
                        html += '<p>‚ùå Nenhum produto encontrado no SQLite.</p>';
                    }
                    
                    resultado.innerHTML = html;
                    
                } else {
                    resultado.innerHTML = '<p>‚ùå SQLite n√£o est√° dispon√≠vel.</p>';
                }
            } catch (error) {
                resultado.innerHTML = `<p>‚ùå Erro ao consultar SQLite: ${error.message}</p>`;
                console.error('Erro SQLite:', error);
            }
        }

        function consultarProdutoEspecifico() {
            const resultado = document.getElementById('resultado-sqlite');
            resultado.innerHTML = '<p>üéØ Consultando produto ID 2 (FertiGota)...</p>';
            
            try {
                if (!window.sqliteManager) {
                    window.sqliteManager = new SQLiteManager();
                }
                
                if (window.sqliteManager.db) {
                    // Consultar apenas o produto ID 2
                    const stmt = window.sqliteManager.db.prepare("SELECT * FROM products WHERE id = ?");
                    stmt.bind([2]);
                    
                    if (stmt.step()) {
                        const produto = stmt.getAsObject();
                        stmt.free();
                        
                        let html = `<h4>üéØ Produto ID 2 (FertiGota) no SQLite:</h4>`;
                        html += `<pre>${JSON.stringify(produto, null, 2)}</pre>`;
                        
                        const preco = parseFloat(produto.price);
                        if (preco === 5.00) {
                            html += `
                                <div style="background: #d4edda; border: 1px solid #c3e6cb; padding: 10px; margin: 10px 0; border-radius: 4px;">
                                    <strong>‚úÖ SUCESSO!</strong><br>
                                    O pre√ßo est√° correto: R$ ${preco.toFixed(2)}
                                </div>
                            `;
                        } else {
                            html += `
                                <div style="background: #f8d7da; border: 1px solid #f5c6cb; padding: 10px; margin: 10px 0; border-radius: 4px;">
                                    <strong>‚ùå INCONSIST√äNCIA!</strong><br>
                                    Pre√ßo encontrado: R$ ${preco.toFixed(2)}<br>
                                    Pre√ßo esperado: R$ 5,00
                                </div>
                            `;
                        }
                        
                        resultado.innerHTML = html;
                    } else {
                        stmt.free();
                        resultado.innerHTML = '<p>‚ùå Produto ID 2 (FertiGota) n√£o encontrado no SQLite.</p>';
                    }
                    
                } else {
                    resultado.innerHTML = '<p>‚ùå SQLite n√£o est√° dispon√≠vel.</p>';
                }
            } catch (error) {
                resultado.innerHTML = `<p>‚ùå Erro ao consultar produto: ${error.message}</p>`;
                console.error('Erro SQLite:', error);
            }
        }

        // Auto-consultar ao carregar
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                consultarProdutoEspecifico();
            }, 500);
        });
    </script>
</body>
</html>
