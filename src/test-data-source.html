<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Fonte de Dados</title>
</head>
<body>
    <h1>Teste de Fonte de Dados</h1>
    <div id="results"></div>

    <script src="js/data-manager.js"></script>
    <script>
        async function testDataSources() {
            const resultsDiv = document.getElementById('results');
            let html = '<h2>An√°lise das Fontes de Dados:</h2>';

            // 1. Verificar localStorage
            const localData = localStorage.getItem('granjaRecantoFelizData');
            if (localData) {
                try {
                    const parsed = JSON.parse(localData);
                    html += `<h3>‚úÖ localStorage encontrado:</h3>`;
                    html += `<p>Produtos: ${parsed.products ? parsed.products.length : 0}</p>`;
                    if (parsed.products && parsed.products.length > 0) {
                        html += `<h4>Pre√ßos no localStorage:</h4><ul>`;
                        parsed.products.forEach(p => {
                            html += `<li>${p.name}: R$ ${p.price}</li>`;
                        });
                        html += `</ul>`;
                    }
                } catch (e) {
                    html += `<h3>‚ùå localStorage com erro: ${e.message}</h3>`;
                }
            } else {
                html += `<h3>‚ö†Ô∏è localStorage vazio</h3>`;
            }

            // 2. Verificar arquivo JSON
            try {
                const response = await fetch('data/produtos.json', { cache: 'no-store' });
                if (response.ok) {
                    const jsonData = await response.json();
                    html += `<h3>‚úÖ Arquivo produtos.json carregado:</h3>`;
                    html += `<p>Produtos: ${jsonData.products ? jsonData.products.length : 0}</p>`;
                    if (jsonData.products && jsonData.products.length > 0) {
                        html += `<h4>Pre√ßos no arquivo JSON:</h4><ul>`;
                        jsonData.products.forEach(p => {
                            html += `<li>${p.name}: R$ ${p.price}</li>`;
                        });
                        html += `</ul>`;
                    }
                } else {
                    html += `<h3>‚ùå Erro ao carregar produtos.json: ${response.status}</h3>`;
                }
            } catch (e) {
                html += `<h3>‚ùå Erro ao acessar produtos.json: ${e.message}</h3>`;
            }

            // 3. Verificar DataManager
            try {
                const dataManager = new DataManager();
                const products = await dataManager.getProducts();
                html += `<h3>‚úÖ DataManager getProducts():</h3>`;
                html += `<p>Produtos retornados: ${products.length}</p>`;
                if (products.length > 0) {
                    html += `<h4>Pre√ßos via DataManager:</h4><ul>`;
                    products.forEach(p => {
                        html += `<li>${p.name}: R$ ${p.price}</li>`;
                    });
                    html += `</ul>`;
                }
            } catch (e) {
                html += `<h3>‚ùå Erro no DataManager: ${e.message}</h3>`;
            }

            // 4. Verificar produtos padr√£o do DataManager
            try {
                const dataManager = new DataManager();
                html += `<h3>üìã Produtos padr√£o (defaultProducts) no DataManager:</h3>`;
                html += `<h4>Pre√ßos padr√£o:</h4><ul>`;
                dataManager.defaultProducts.forEach(p => {
                    html += `<li>${p.name}: R$ ${p.price}</li>`;
                });
                html += `</ul>`;
            } catch (e) {
                html += `<h3>‚ùå Erro ao acessar defaultProducts: ${e.message}</h3>`;
            }

            resultsDiv.innerHTML = html;
        }

        // Executar teste quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', testDataSources);
    </script>
</body>
</html>
