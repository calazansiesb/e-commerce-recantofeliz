<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug URL Espec√≠fico</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background-color: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .section { background: white; padding: 20px; margin: 10px 0; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .button { background: #4CAF50; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        .button:hover { background: #45a049; }
        .red { background: #f44336; }
        .red:hover { background: #da190b; }
        .blue { background: #2196F3; }
        .blue:hover { background: #0b7dda; }
        pre { background: #f8f8f8; padding: 15px; border-radius: 4px; overflow-x: auto; max-height: 400px; font-size: 12px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .product-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .url-test { border: 2px solid #ddd; padding: 15px; margin: 10px; border-radius: 8px; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; padding: 10px; margin: 10px 0; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Debug URL Espec√≠fico</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è Este teste simula os diferentes caminhos de carregamento</strong><br>
            Teste 1: Simula localhost:8080 (carregamento direto)<br>
            Teste 2: Simula localhost:8080/index.html#produtos (carregamento via √¢ncora)
        </div>

        <div class="section">
            <h2>Controles</h2>
            <button class="button" onclick="testarCarregamento1()">üîç Testar Localhost:8080</button>
            <button class="button blue" onclick="testarCarregamento2()">üîç Testar Index.html#produtos</button>
            <button class="button red" onclick="limparTestes()">üóëÔ∏è Limpar Testes</button>
        </div>

        <div class="grid">
            <div class="url-test">
                <h3>üìç Teste 1: localhost:8080</h3>
                <div id="teste1-resultado">
                    <p>Clique no bot√£o para testar...</p>
                </div>
            </div>
            
            <div class="url-test">
                <h3>üìç Teste 2: index.html#produtos</h3>
                <div id="teste2-resultado">
                    <p>Clique no bot√£o para testar...</p>
                </div>
            </div>
        </div>

        <div class="section">
            <h3>üìä Compara√ß√£o</h3>
            <div id="comparacao-resultado">
                <p>Execute ambos os testes para ver a compara√ß√£o...</p>
            </div>
        </div>

        <div class="section">
            <h3>üîß Informa√ß√µes do Sistema</h3>
            <div id="sistema-info"></div>
        </div>
    </div>

    <script src="js/data-manager.js"></script>
    <!-- sqlite disabled: <script src="js/sqlite-manager.js"></script> -->
    <script>
        let resultado1 = null;
        let resultado2 = null;

        function log(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML += `<div>${new Date().toLocaleTimeString()}: ${message}</div>`;
        }

        function clearContainer(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }

        // Simular carregamento como se fosse localhost:8080 (primeira tela)
        function testarCarregamento1() {
            clearContainer('teste1-resultado');
            log('teste1-resultado', 'üöÄ Iniciando teste localhost:8080...');
            
            try {
                // Simular inicializa√ß√£o como se fosse a primeira p√°gina
                log('teste1-resultado', 'üîÑ Simulando inicializa√ß√£o da p√°gina principal...');
                
                // Verificar localStorage diretamente
                const localData = localStorage.getItem('granjaRecantoFelizData');
                if (localData) {
                    const parsed = JSON.parse(localData);
                    const produtos = parsed.products || [];
                    log('teste1-resultado', `üì¶ localStorage: ${produtos.length} produtos`);
                    resultado1 = { fonte: 'localStorage', produtos: produtos.length, dados: produtos };
                } else {
                    log('teste1-resultado', 'üì¶ localStorage: Vazio');
                    resultado1 = { fonte: 'localStorage', produtos: 0, dados: [] };
                }
                
                // Simular DataManager novo
                const tempDataManager = new DataManager();
                const produtosDataManager = tempDataManager.getActiveProducts();
                log('teste1-resultado', `‚öôÔ∏è DataManager (novo): ${produtosDataManager.length} produtos`);
                
                // Se diferentes, mostrar detalhes
                if (resultado1.produtos !== produtosDataManager.length) {
                    log('teste1-resultado', `‚ö†Ô∏è DIFEREN√áA: localStorage=${resultado1.produtos}, DataManager=${produtosDataManager.length}`);
                }
                
                // Mostrar produtos encontrados
                if (produtosDataManager.length > 0) {
                    log('teste1-resultado', 'üìã Produtos encontrados:');
                    produtosDataManager.forEach((p, i) => {
                        log('teste1-resultado', `  ${i+1}. ${p.name} (ID: ${p.id})`);
                    });
                } else {
                    log('teste1-resultado', '‚ùå Nenhum produto encontrado');
                }
                
                resultado1.dataManager = produtosDataManager.length;
                
            } catch (error) {
                log('teste1-resultado', `‚ùå Erro no teste 1: ${error.message}`);
            }
            
            if (resultado1 && resultado2) {
                compararResultados();
            }
        }

        // Simular carregamento como se fosse localhost:8080/index.html#produtos (segunda tela)
        function testarCarregamento2() {
            clearContainer('teste2-resultado');
            log('teste2-resultado', 'üöÄ Iniciando teste index.html#produtos...');
            
            try {
                // Simular como se a p√°gina j√° estivesse carregada e navegando para #produtos
                log('teste2-resultado', 'üîÑ Simulando navega√ß√£o para se√ß√£o produtos...');
                
                // Usar o DataManager existente
                if (window.dataManager) {
                    const produtosExistente = window.dataManager.getActiveProducts();
                    log('teste2-resultado', `‚öôÔ∏è DataManager (existente): ${produtosExistente.length} produtos`);
                    
                    log('teste2-resultado', 'üìã Produtos do DataManager existente:');
                    produtosExistente.forEach((p, i) => {
                        log('teste2-resultado', `  ${i+1}. ${p.name} (ID: ${p.id})`);
                    });
                    
                    resultado2 = { fonte: 'DataManager existente', produtos: produtosExistente.length, dados: produtosExistente };
                } else {
                    log('teste2-resultado', '‚ö†Ô∏è DataManager n√£o encontrado, criando novo...');
                    const novoDataManager = new DataManager();
                    const produtosNovo = novoDataManager.getActiveProducts();
                    log('teste2-resultado', `‚öôÔ∏è DataManager (novo): ${produtosNovo.length} produtos`);
                    
                    resultado2 = { fonte: 'DataManager novo', produtos: produtosNovo.length, dados: produtosNovo };
                }
                
                // Verificar SQLite tamb√©m
                if (window.sqliteManager && window.sqliteManager.db) {
                    const produtosSQLite = window.sqliteManager.getProducts();
                    log('teste2-resultado', `üóÑÔ∏è SQLite: ${produtosSQLite.length} produtos`);
                    
                    if (produtosSQLite.length !== resultado2.produtos) {
                        log('teste2-resultado', `‚ö†Ô∏è DIFEREN√áA: DataManager=${resultado2.produtos}, SQLite=${produtosSQLite.length}`);
                    }
                }
                
            } catch (error) {
                log('teste2-resultado', `‚ùå Erro no teste 2: ${error.message}`);
            }
            
            if (resultado1 && resultado2) {
                compararResultados();
            }
        }

        function compararResultados() {
            const container = document.getElementById('comparacao-resultado');
            container.innerHTML = '<h4>üìä Compara√ß√£o dos Resultados:</h4>';
            
            container.innerHTML += `
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div>
                        <strong>localhost:8080</strong><br>
                        Fonte: ${resultado1.fonte}<br>
                        Produtos: ${resultado1.produtos}<br>
                        DataManager: ${resultado1.dataManager || 'N/A'}
                    </div>
                    <div>
                        <strong>index.html#produtos</strong><br>
                        Fonte: ${resultado2.fonte}<br>
                        Produtos: ${resultado2.produtos}
                    </div>
                </div>
            `;
            
            if (resultado1.produtos !== resultado2.produtos) {
                container.innerHTML += `
                    <div style="background: #ffebee; padding: 10px; margin: 10px 0; border-radius: 4px; border-left: 4px solid #f44336;">
                        <strong>üö® PROBLEMA ENCONTRADO!</strong><br>
                        Diferentes n√∫meros de produtos sendo exibidos:<br>
                        localhost:8080 = ${resultado1.produtos} produtos<br>
                        index.html#produtos = ${resultado2.produtos} produtos
                    </div>
                `;
                
                // Analisar as diferen√ßas
                if (resultado1.dados && resultado2.dados) {
                    const ids1 = resultado1.dados.map(p => p.id).sort();
                    const ids2 = resultado2.dados.map(p => p.id).sort();
                    
                    container.innerHTML += `
                        <div style="background: #f3e5f5; padding: 10px; margin: 10px 0; border-radius: 4px;">
                            <strong>üîç An√°lise detalhada:</strong><br>
                            IDs no teste 1: [${ids1.join(', ')}]<br>
                            IDs no teste 2: [${ids2.join(', ')}]
                        </div>
                    `;
                }
            } else {
                container.innerHTML += `
                    <div style="background: #e8f5e8; padding: 10px; margin: 10px 0; border-radius: 4px; border-left: 4px solid #4caf50;">
                        <strong>‚úÖ RESULTADOS CONSISTENTES!</strong><br>
                        Ambos mostram ${resultado1.produtos} produtos.
                    </div>
                `;
            }
        }

        function limparTestes() {
            clearContainer('teste1-resultado');
            clearContainer('teste2-resultado');
            clearContainer('comparacao-resultado');
            document.getElementById('comparacao-resultado').innerHTML = '<p>Execute ambos os testes para ver a compara√ß√£o...</p>';
            resultado1 = null;
            resultado2 = null;
        }

        // Mostrar informa√ß√µes do sistema
        function mostrarInfoSistema() {
            const container = document.getElementById('sistema-info');
            
            const info = [
                `URL atual: ${window.location.href}`,
                `localStorage: ${localStorage.getItem('granjaRecantoFelizData') ? 'Presente' : 'Vazio'}`,
                `DataManager global: ${window.dataManager ? 'Presente' : 'Ausente'}`,
                `SQLiteManager global: ${window.sqliteManager ? 'Presente' : 'Ausente'}`,
                `User Agent: ${navigator.userAgent}`
            ];
            
            container.innerHTML = info.map(i => `<div>${i}</div>`).join('');
        }

        // Auto-executar info do sistema
        document.addEventListener('DOMContentLoaded', () => {
            mostrarInfoSistema();
        });
    </script>
</body>
</html>
