<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corre√ß√£o Imediata - Produtos</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn { background: #4CAF50; color: white; padding: 15px 30px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin: 10px 5px; }
        .btn:hover { background: #45a049; }
        .btn-red { background: #f44336; }
        .btn-red:hover { background: #da190b; }
        .status { padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        pre { background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; font-size: 12px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Corre√ß√£o Imediata de Produtos</h1>
        <p>Esta p√°gina for√ßa a corre√ß√£o do problema "Nenhum produto encontrado".</p>
        
        <div id="status"></div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button class="btn" onclick="corrigirAgora()">üöÄ Corrigir Produtos Agora</button>
            <button class="btn btn-red" onclick="limparTudo()">üóëÔ∏è Limpar Tudo e Reiniciar</button>
        </div>
        
        <div style="text-align: center; margin: 20px 0;">
            <a href="admin.html" class="btn" style="text-decoration: none;">üìä Ir para Admin</a>
            <a href="index.html" class="btn" style="text-decoration: none;">üè† Ir para Site</a>
        </div>
        
        <div id="debug-info"></div>
    </div>

    <script>
        const PRODUTOS_GARANTIDOS = [
            {
                id: 1,
                name: "Substrato BioF√©rtil 3 Anos",
                category: "fertilizantes",
                slogan: "Mais do que Adubo: um substrato vivo e completo.",
                description: "Com um processo de matura√ß√£o de 3 anos, nosso substrato √© uma terra viva e completa, rica em mat√©ria org√¢nica e microrganismos ben√©ficos.",
                price: 40.00,
                image: "imagens/produtos/1/1.png",
                stock: 25,
                active: true
            },
            {
                id: 2,
                name: "FertiGota",
                category: "fertilizantes",
                slogan: "Adubo de galinha l√≠quido e potente.",
                description: "Nosso fertilizante l√≠quido √© produzido atrav√©s de um processo de biodigestor anaer√≥bico, transformando dejetos de galinha em um adubo rico em nutrientes.",
                price: 25.00,
                image: "imagens/produtos/2/1.png",
                stock: 40,
                active: true
            },
            {
                id: 3,
                name: "Ovos Caipira 10",
                category: "ovos",
                slogan: "10 ovos frescos da granja.",
                description: "Ovos caipira selecionados, direto da granja para sua mesa. Embalagem com 10 unidades.",
                price: 18.00,
                image: "imagens/produtos/3/1.jpeg",
                stock: 120,
                active: true
            },
            {
                id: 4,
                name: "Ovos Caipira 20",
                category: "ovos",
                slogan: "20 ovos frescos da granja.",
                description: "Ovos caipira selecionados, direto da granja para sua mesa. Embalagem com 20 unidades.",
                price: 30.00,
                image: "imagens/produtos/4/1.jpeg",
                stock: 80,
                active: true
            },
            {
                id: 5,
                name: "Ovos Caipira 30",
                category: "ovos",
                slogan: "30 ovos frescos da granja.",
                description: "Ovos caipira selecionados, direto da granja para sua mesa. Embalagem com 30 unidades.",
                price: 45.00,
                image: "imagens/produtos/5/1.png",
                stock: 50,
                active: true
            },
            {
                id: 6,
                name: "Galinha Caipira Picada",
                category: "aves",
                slogan: "Galinha caipira cortada, pronta para cozinhar.",
                description: "Galinha caipira picada, sabor aut√™ntico da ro√ßa. Ideal para receitas tradicionais.",
                price: 60.00,
                image: "imagens/produtos/6/1.png",
                stock: 15,
                active: true
            },
            {
                id: 7,
                name: "Galinha Caipira Inteira",
                category: "aves",
                slogan: "Galinha caipira inteira, fresca e saborosa.",
                description: "Galinha caipira inteira, criada solta e alimentada naturalmente. Perfeita para assados e cozidos.",
                price: 110.00,
                image: "imagens/produtos/7/1.png",
                stock: 8,
                active: true
            }
        ];

        function mostrarStatus(mensagem, tipo = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="${tipo}">${mensagem}</div>`;
        }

        function mostrarDebug() {
            const debugDiv = document.getElementById('debug-info');
            const data = localStorage.getItem('granjaRecantoFelizData');
            
            let debugInfo = '<h3>üîç Informa√ß√µes de Debug:</h3>';
            
            if (data) {
                try {
                    const parsed = JSON.parse(data);
                    debugInfo += `
                        <div class="success">
                            ‚úÖ localStorage encontrado<br>
                            üì¶ Produtos: ${parsed.products?.length || 0}<br>
                            üìÖ √öltima atualiza√ß√£o: ${parsed.lastUpdate || 'N/A'}<br>
                            üîß Fonte: ${parsed.source || 'N/A'}
                        </div>
                        <details>
                            <summary>Ver dados completos</summary>
                            <pre>${JSON.stringify(parsed, null, 2)}</pre>
                        </details>
                    `;
                } catch (error) {
                    debugInfo += `<div class="error">‚ùå Dados corrompidos: ${error.message}</div>`;
                }
            } else {
                debugInfo += '<div class="error">‚ùå Nenhum dado encontrado no localStorage</div>';
            }
            
            debugDiv.innerHTML = debugInfo;
        }

        function corrigirAgora() {
            mostrarStatus('üîÑ Aplicando corre√ß√£o...', 'info');
            
            try {
                // 1. For√ßar dados no localStorage
                const dadosCorrigidos = {
                    products: PRODUTOS_GARANTIDOS,
                    lastUpdate: new Date().toISOString(),
                    source: 'correcao-forcada',
                    initialized: true,
                    version: '2.0.1'
                };
                
                localStorage.setItem('granjaRecantoFelizData', JSON.stringify(dadosCorrigidos));
                
                // 2. Verificar se salvou
                const verificacao = localStorage.getItem('granjaRecantoFelizData');
                if (!verificacao) {
                    throw new Error('Falha ao salvar no localStorage');
                }
                
                const parsed = JSON.parse(verificacao);
                if (!parsed.products || parsed.products.length !== 7) {
                    throw new Error('Dados n√£o foram salvos corretamente');
                }
                
                mostrarStatus(`‚úÖ Corre√ß√£o aplicada com sucesso!<br>üì¶ ${parsed.products.length} produtos restaurados<br>üïí ${new Date().toLocaleString()}`, 'success');
                
                setTimeout(() => {
                    mostrarDebug();
                }, 500);
                
            } catch (error) {
                mostrarStatus(`‚ùå Erro na corre√ß√£o: ${error.message}`, 'error');
            }
        }

        function limparTudo() {
            if (confirm('Tem certeza? Isso vai limpar TODOS os dados salvos.')) {
                try {
                    // Limpar localStorage
                    localStorage.removeItem('granjaRecantoFelizData');
                    localStorage.removeItem('adminToken');
                    localStorage.removeItem('carrinho');
                    localStorage.removeItem('mensagemAgradecimento');
                    localStorage.removeItem('imagemAgradecimento');
                    
                    mostrarStatus('üóëÔ∏è Todos os dados foram limpos. Clique em "Corrigir Produtos Agora" para restaurar.', 'info');
                    
                    setTimeout(() => {
                        mostrarDebug();
                    }, 500);
                    
                } catch (error) {
                    mostrarStatus(`‚ùå Erro ao limpar: ${error.message}`, 'error');
                }
            }
        }

        // Executar verifica√ß√£o inicial
        document.addEventListener('DOMContentLoaded', () => {
            mostrarDebug();
            
            // Auto-corre√ß√£o se n√£o h√° produtos
            const data = localStorage.getItem('granjaRecantoFelizData');
            if (!data) {
                mostrarStatus('‚ö†Ô∏è Nenhum dado encontrado. Clique em "Corrigir Produtos Agora".', 'error');
            } else {
                try {
                    const parsed = JSON.parse(data);
                    if (!parsed.products || parsed.products.length === 0) {
                        mostrarStatus('‚ö†Ô∏è Produtos n√£o encontrados. Clique em "Corrigir Produtos Agora".', 'error');
                    } else {
                        mostrarStatus(`‚úÖ Sistema OK - ${parsed.products.length} produtos encontrados`, 'success');
                    }
                } catch (error) {
                    mostrarStatus('‚ö†Ô∏è Dados corrompidos. Clique em "Corrigir Produtos Agora".', 'error');
                }
            }
        });
    </script>
</body>
</html>